---
/**
 * Accordion Component
 * 
 * Expandable/collapsible content sections
 * 
 * @component
 */

export interface AccordionItem {
  id: string;
  title: string;
  content?: string;
  disabled?: boolean;
}

export interface Props {
  items: AccordionItem[];
  allowMultiple?: boolean;
  defaultOpen?: string[];
  class?: string;
}

const {
  items,
  allowMultiple = false,
  defaultOpen = [],
  class: className = '',
} = Astro.props;

const initialState = allowMultiple
  ? `openItems: ${JSON.stringify(defaultOpen)}`
  : `openItem: '${defaultOpen[0] || ''}'`;
---

<div
  x-data={`{ ${initialState} }`}
  class:list={['space-y-2', className]}
>
  {items.map((item) => (
    <div class="border border-border-primary rounded-xl overflow-hidden bg-elevated">
      <!-- Accordion Header -->
      <button
        type="button"
        @click={
          allowMultiple
            ? `openItems.includes('${item.id}') ? openItems = openItems.filter(i => i !== '${item.id}') : openItems = [...openItems, '${item.id}']`
            : `openItem = openItem === '${item.id}' ? '' : '${item.id}'`
        }
        :aria-expanded={
          allowMultiple
            ? `openItems.includes('${item.id}')`
            : `openItem === '${item.id}'`
        }
        disabled={item.disabled}
        class="w-full flex items-center justify-between px-6 py-4 text-left hover:bg-base/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
      >
        <span class="font-semibold text-text-primary">{item.title}</span>
        <svg
          class:list={[
            'h-5 w-5 text-text-secondary transition-transform',
            allowMultiple
              ? ':class="openItems.includes(\'{item.id}\') && \'rotate-180\'"'
              : ':class="openItem === \'{item.id}\' && \'rotate-180\'"',
          ]}
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 9l-7 7-7-7"
          ></path>
        </svg>
      </button>
      
      <!-- Accordion Panel -->
      <div
        x-show={
          allowMultiple
            ? `openItems.includes('${item.id}')`
            : `openItem === '${item.id}'`
        }
        x-collapse
        class="border-t border-border-primary"
      >
        <div class="px-6 py-4 text-text-secondary">
          {item.content && <p>{item.content}</p>}
          <!-- Note: For custom content, use the default slot with data-accordion-id attributes -->
          <!-- Example: <div data-accordion-id="item1">Custom content</div> -->
        </div>
      </div>
    </div>
  ))}
</div>
