---
/**
 * Progress Component
 *
 * Progress bar indicator
 *
 * @component
 */

export interface Props {
    value: number;
    max?: number;
    size?: "sm" | "md" | "lg";
    showLabel?: boolean;
    indeterminate?: boolean;
    color?: string;
    class?: string;
}

const {
    value,
    max = 100,
    size = "md",
    showLabel = false,
    indeterminate = false,
    color,
    class: className = "",
} = Astro.props;

const percentage = Math.min(Math.max((value / max) * 100, 0), 100);

const sizeClasses = {
    sm: "h-1",
    md: "h-2",
    lg: "h-3",
};

const colorClass = color || "bg-primary";
---

<div class:list={["w-full", className]}>
    {
        showLabel && !indeterminate && (
            <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-medium text-text-primary">
                    <slot name="label">Progress</slot>
                </span>
                <span class="text-sm font-medium text-text-secondary">
                    {Math.round(percentage)}%
                </span>
            </div>
        )
    }

    <div
        class:list={[
            "w-full rounded-full bg-border-secondary overflow-hidden",
            sizeClasses[size],
        ]}
        role="progressbar"
        aria-valuenow={indeterminate ? undefined : value}
        aria-valuemin="0"
        aria-valuemax={max}
        aria-label={indeterminate ? "Loading" : undefined}
    >
        <div
            class:list={[
                "h-full rounded-full transition-all duration-300",
                colorClass,
                indeterminate && "animate-progress-indeterminate",
            ]}
            style={indeterminate ? undefined : `width: ${percentage}%`}
        >
        </div>
    </div>
</div>

<style>
    @keyframes progress-indeterminate {
        0% {
            width: 30%;
            margin-left: 0%;
        }
        50% {
            width: 30%;
            margin-left: 70%;
        }
        100% {
            width: 30%;
            margin-left: 0%;
        }
    }

    .animate-progress-indeterminate {
        animation: progress-indeterminate 1.5s ease-in-out infinite;
    }
</style>
