---
/**
 * ThemeProvider Component
 *
 * SSR-safe configuration provider for design system.
 * Injects global configuration for locale, brand, and date formatting.
 * Must wrap application root.
 *
 * @component
 * @example
 * ```astro
 * ---
 * import { ThemeProvider } from '@jjalaa/astro-ui/components';
 * ---
 * <ThemeProvider locale="nl-NL" brand="aaltjesdagen">
 *   <slot />
 * </ThemeProvider>
 * ```
 */

export interface Props {
    /** Locale for date/time formatting (default: 'en-US') */
    locale?: string;
    /** Brand preset to apply (default: 'default') */
    brand?: string;
    /** Custom date format options */
    dateFormat?: Intl.DateTimeFormatOptions;
    /** Custom time format options */
    timeFormat?: Intl.DateTimeFormatOptions;
}

const {
    locale = "en-US",
    brand = "default",
    dateFormat = {
        weekday: "long",
        day: "numeric",
        month: "long",
    },
    timeFormat = {
        hour: "2-digit",
        minute: "2-digit",
    },
} = Astro.props;

// Create config object
const config = {
    locale,
    dateFormat,
    timeFormat,
};

// Inject config into globalThis for SSR
if (typeof globalThis !== "undefined") {
    (globalThis as any).__DESIGN_SYSTEM_CONFIG__ = config;
}
---

<div
    data-brand={brand}
    data-locale={locale}
    data-config={JSON.stringify(config)}
    class="design-system-root"
>
    <slot />
</div>

<script>
    // Client-side: Read config from DOM and inject into window
    function initializeDesignSystemConfig() {
        const root = document.querySelector("[data-config]");
        if (root) {
            const configAttr = root.getAttribute("data-config");
            if (configAttr) {
                const config = JSON.parse(configAttr);
                (window as any).__DESIGN_SYSTEM_CONFIG__ = config;
            }
        }
    }

    // Initialize on page load
    initializeDesignSystemConfig();

    // Re-initialize on Astro view transitions
    document.addEventListener("astro:page-load", initializeDesignSystemConfig);
</script>

<style>
    .design-system-root {
        /* Transparent wrapper - doesn't affect layout */
        display: contents;
    }
</style>
