---
/**
 * Popover Component
 *
 * Similar to Tooltip but for more complex content
 *
 * @component
 */

export interface Props {
    title?: string;
    placement?: "top" | "bottom" | "left" | "right";
    trigger?: "click" | "hover";
    class?: string;
}

const {
    title,
    placement = "bottom",
    trigger = "click",
    class: className = "",
} = Astro.props;

const placementClasses = {
    top: "bottom-full left-1/2 -translate-x-1/2 mb-2",
    bottom: "top-full left-1/2 -translate-x-1/2 mt-2",
    left: "right-full top-1/2 -translate-y-1/2 mr-2",
    right: "left-full top-1/2 -translate-y-1/2 ml-2",
};

const arrowClasses = {
    top: "top-full left-1/2 -translate-x-1/2 border-t-elevated border-x-transparent border-b-transparent",
    bottom: "bottom-full left-1/2 -translate-x-1/2 border-b-elevated border-x-transparent border-t-transparent",
    left: "left-full top-1/2 -translate-y-1/2 border-l-elevated border-y-transparent border-r-transparent",
    right: "right-full top-1/2 -translate-y-1/2 border-r-elevated border-y-transparent border-l-transparent",
};

const triggerEvent =
    trigger === "click"
        ? '@click="open = !open"'
        : '@mouseenter="open = true" @mouseleave="open = false"';
---

<div
    x-data="{ open: false }"
    @click.away="open = false"
    @keydown.escape.window="open = false"
    class:list={["relative inline-block", className]}
>
    <!-- Trigger -->
    <div
        {...{
            [triggerEvent.split("=")[0]]: triggerEvent
                .split("=")[1]
                .replace(/"/g, ""),
        }}
    >
        <slot name="trigger" />
    </div>

    <!-- Popover -->
    <div
        x-show="open"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0 scale-95"
        x-transition:enter-end="opacity-100 scale-100"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class:list={[
            "absolute z-tooltip w-64 bg-elevated border border-border-primary rounded-xl shadow-lg",
            placementClasses[placement],
        ]}
        role="dialog"
    >
        <!-- Arrow -->
        <div
            class:list={[
                "absolute w-0 h-0 border-[6px]",
                arrowClasses[placement],
            ]}
            aria-hidden="true"
        >
        </div>

        {
            title && (
                <div class="px-4 py-3 border-b border-border-primary">
                    <h4 class="font-semibold text-text-primary">{title}</h4>
                </div>
            )
        }

        <div class="px-4 py-3 text-sm text-text-secondary">
            <slot />
        </div>
    </div>
</div>
