---
/**
 * Dropdown Component
 *
 * Dropdown menu with items
 *
 * @component
 */

export interface DropdownItem {
    label: string;
    href?: string;
    onClick?: string;
    divider?: boolean;
    disabled?: boolean;
    icon?: string;
}

export interface Props {
    items: DropdownItem[];
    placement?: "bottom-start" | "bottom-end" | "top-start" | "top-end";
    class?: string;
}

const {
    items,
    placement = "bottom-start",
    class: className = "",
} = Astro.props;

const placementClasses = {
    "bottom-start": "top-full left-0 mt-2",
    "bottom-end": "top-full right-0 mt-2",
    "top-start": "bottom-full left-0 mb-2",
    "top-end": "bottom-full right-0 mb-2",
};
---

<div
    x-data="{ open: false }"
    @click.away="open = false"
    @keydown.escape.window="open = false"
    class:list={["relative inline-block", className]}
>
    <!-- Trigger -->
    <div @click="open = !open">
        <slot name="trigger" />
    </div>

    <!-- Dropdown Menu -->
    <div
        x-show="open"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0 scale-95"
        x-transition:enter-end="opacity-100 scale-100"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class:list={[
            "absolute z-dropdown min-w-[12rem] bg-elevated border border-border-primary rounded-xl shadow-lg overflow-hidden",
            placementClasses[placement],
        ]}
        role="menu"
    >
        <div class="py-1">
            {
                items.map((item) =>
                    item.divider ? (
                        <div
                            class="border-t border-border-primary my-1"
                            role="separator"
                        />
                    ) : item.href ? (
                        <a
                            href={item.href}
                            class:list={[
                                "flex items-center gap-3 px-4 py-2.5 text-sm text-text-primary hover:bg-base transition-colors",
                                item.disabled &&
                                    "opacity-50 cursor-not-allowed pointer-events-none",
                            ]}
                            role="menuitem"
                        >
                            {item.label}
                        </a>
                    ) : (
                        <button
                            type="button"
                            @click={item.onClick}
                            disabled={item.disabled}
                            class:list={[
                                "w-full flex items-center gap-3 px-4 py-2.5 text-sm text-left text-text-primary hover:bg-base transition-colors",
                                "disabled:opacity-50 disabled:cursor-not-allowed",
                            ]}
                            role="menuitem"
                        >
                            {item.label}
                        </button>
                    ),
                )
            }
        </div>
    </div>
</div>
